import{i as q,u as S,T as U}from"./index-02e4452f.js";import{C as _,d as V,L as A,k as g,_ as N,r as u,o as C,q as $,w as o,b as l,j as B,x as z,c as G,a as v,e as D,y as O,z as j,l as I}from"./index-45934075.js";function J(e){return _({url:"admin/role/page",method:"post",data:e})}function M(e){return _({url:"admin/role",method:"post",data:e})}function H(e){return _({url:"admin/role",method:"put",data:e})}function K(e){return console.log(e),_({url:"admin/role",method:"DELETE",data:e})}const k=[{value:1,label:"美食"},{value:2,label:"小吃"},{value:3,label:"糕点"}],L=[{value:1,label:"今天"},{value:2,label:"明天"},{value:3,label:"后天"}],P=V({components:{Layer:A,imageUploader:q},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,a){const r=g(null),c=g(null);let s=g({name:"",cover:""});const h={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],number:[{required:!0,message:"请输入数字",trigger:"blur"}],choose:[{required:!0,message:"请选择",trigger:"blur"}],radio:[{required:!0,message:"请选择",trigger:"blur"}]};n();function n(){e.layer.row&&(s.value=JSON.parse(JSON.stringify(e.layer.row)))}return{form:s,rules:h,layerDom:c,ruleForm:r,selectData:k,radioData:L,uploadUrl:S}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let a=this.form;this.layer.row?this.updateForm(a):this.addForm(a)}else return!1})},addForm(e){M(e).then(a=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){H(e).then(a=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function Q(e,a,r,c,s,h){const n=u("el-input"),i=u("el-form-item"),b=u("el-form"),m=u("Layer",!0);return C(),$(m,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:o(()=>[l(b,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px","label-position":"left",style:{"margin-left":"50px","margin-right":"30px"}},{default:o(()=>[l(i,{label:"角色名",prop:"businessName"},{default:o(()=>[l(n,{modelValue:e.form.role,"onUpdate:modelValue":a[0]||(a[0]=p=>e.form.role=p),placeholder:"商家名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"描述",prop:"businessAddress"},{default:o(()=>[l(n,{modelValue:e.form.description,"onUpdate:modelValue":a[1]||(a[1]=p=>e.form.description=p),placeholder:"商家地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const R=N(P,[["render",Q]]),W=V({name:"crudTable",components:{Table:U,Layer:R},setup(){const e=B({input:""}),a=B({show:!1,title:"新增",showButton:!0}),r=B({index:1,size:20,total:0}),c=g(!0),s=g([]),h=g([]),n=d=>{h.value=d},i=d=>{c.value=!0,d&&(r.index=1);let y={page:r.index,pageSize:r.size,...e};J(y).then(t=>{console.log(t);let F=t.data.list;Array.isArray(F)&&F.forEach(f=>{const T=k.find(w=>w.value===f.choose);T?f.chooseName=T.label:f.chooseName=f.choose;const E=L.find(w=>w.value===f.radio);E?f.radioName=E.label:f.radio}),s.value=t.data.list,r.total=Number(t.data.total)}).catch(t=>{s.value=[],r.index=1,r.total=0}).finally(()=>{c.value=!1})},b=d=>{let y=d.map(t=>t.businessId);K(y).then(t=>{I({type:"success",message:"删除成功"}),i(s.value.length===1)})},m=()=>{a.title="新增数据",a.show=!0,delete a.row},p=d=>{a.title="编辑数据",a.row=d,a.show=!0};return i(!0),{query:e,tableData:s,chooseData:h,loading:c,page:r,layer:a,handleSelectionChange:n,handleAdd:m,handleEdit:p,handleDel:b,getTableData:i}}}),X={class:"layout-container"},Y={class:"layout-container-form flex space-between"},Z={class:"layout-container-form-handle"},x={class:"layout-container-form-search"},ee={class:"layout-container-table"};function ae(e,a,r,c,s,h){const n=u("el-button"),i=u("el-popconfirm"),b=u("el-input"),m=u("el-table-column"),p=u("Table"),d=u("Layer"),y=z("loading");return C(),G("div",X,[v("div",Y,[v("div",Z,[l(n,{type:"primary",icon:"el-icon-circle-plus-outline",onClick:e.handleAdd},{default:o(()=>[D("新增")]),_:1},8,["onClick"]),l(i,{title:"批量删除",onConfirm:a[0]||(a[0]=t=>e.handleDel(e.chooseData))},{reference:o(()=>[l(n,{type:"danger",icon:"el-icon-delete",disabled:e.chooseData.length===0},{default:o(()=>[D("批量删除")]),_:1},8,["disabled"])]),_:1})]),v("div",x,[l(b,{modelValue:e.query.input,"onUpdate:modelValue":a[1]||(a[1]=t=>e.query.input=t),placeholder:"请输入关键词进行检索",onChange:a[2]||(a[2]=t=>e.getTableData(!0))},null,8,["modelValue"]),l(n,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[3]||(a[3]=t=>e.getTableData(!0))},{default:o(()=>[D("搜索")]),_:1})])]),v("div",ee,[O((C(),$(p,{ref:"table",page:e.page,"onUpdate:page":a[4]||(a[4]=t=>e.page=t),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:o(()=>[l(m,{prop:"id",label:"角色编号","header-align":"center",align:"center"}),l(m,{prop:"role",label:"角色名","header-align":"center",align:"center"}),l(m,{prop:"description",label:"描述","header-align":"center",align:"center"}),l(m,{label:"操作",align:"center",fixed:"right",width:"200"},{default:o(t=>[l(n,{onClick:F=>e.handleEdit(t.row)},{default:o(()=>[D("编辑")]),_:2},1032,["onClick"]),l(i,{title:"删除",onConfirm:F=>e.handleDel([t.row])},{reference:o(()=>[l(n,{type:"danger"},{default:o(()=>[D("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[y,e.loading]]),e.layer.show?(C(),$(d,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):j("",!0)])])}const oe=N(W,[["render",ae]]);export{oe as default};
