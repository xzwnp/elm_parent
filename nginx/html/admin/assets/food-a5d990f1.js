import{b as G}from"./business-f5d858fe.js";import{d as E,k as v,D as U,_ as w,r as g,x as z,o as _,c as F,a as C,b as a,y as A,F as j,v as O,n as J,t as H,z as I,p as K,f as Q,C as B,L as R,q as N,w as f,j as T,E as W,l as X,e as $,G as Y}from"./index-45934075.js";import{i as Z,T as M}from"./index-02e4452f.js";function k(e,t,l,u){var d,c=!1,o=0;function s(){d&&clearTimeout(d)}function r(){s(),c=!0}typeof t!="boolean"&&(u=l,l=t,t=void 0);function p(){for(var y=arguments.length,i=new Array(y),m=0;m<y;m++)i[m]=arguments[m];var h=this,n=Date.now()-o;if(c)return;function b(){o=Date.now(),l.apply(h,i)}function D(){d=void 0}u&&!d&&b(),s(),u===void 0&&n>e?b():t!==!0&&(d=setTimeout(u?D:b,u===void 0?e-n:e))}return p.cancel=r,p}function x(e,t,l){return l===void 0?k(e,t,!1):k(e,l,t!==!1)}const ee=E({setup(){const e=v(null),t={index:1,size:30,total:0};let l=v(""),u=v([]),d=v(!0),c=v(!0),o=U("active"),s=v(!1);const r=i=>{if(c.value=!0,i||d.value)d.value=!1,t.index=1,e.value&&(e.value.scrollTop=0);else if(t.index*t.size>=t.total){c.value=!1,s.value=!0;return}let m={page:t.index,pageSize:t.size,keyword:l.value};G(m).then(h=>{t.index===1?(u.value=h.data.list,o.value=u.value[0]):u.value=u.value.concat(h.data.list),t.index+=1,t.total=h.data.total}).catch(h=>{t.index=1,t.total=0,u.value=[]}).finally(()=>{c.value=!1})},p=x(300,r),y=i=>{o.value=i};return r(!0),{listDom:e,loading:c,nomore:s,input:l,list:u,active:o,getCategoryData:r,searchData:p,changeActive:y}}}),te=e=>(K("data-v-18277bde"),e=e(),Q(),e),ae={class:"category"},oe={class:"header-box"},le=te(()=>C("h2",null,"分类列表",-1)),ne={class:"list system-scrollbar",ref:"listDom","infinite-scroll-immediate":!1,style:{overflow:"auto"}},ue=["onClick"],re={key:0,class:"load-tip"},se={key:1,class:"load-tip"};function ie(e,t,l,u,d,c){const o=g("el-input"),s=z("infinite-scroll");return _(),F("div",ae,[C("div",oe,[le,a(o,{modelValue:e.input,"onUpdate:modelValue":t[0]||(t[0]=r=>e.input=r),placeholder:"请输入商家名称",onInput:t[1]||(t[1]=r=>e.searchData(!0))},null,8,["modelValue"])]),A((_(),F("ul",ne,[(_(!0),F(j,null,O(e.list,r=>(_(),F("li",{key:r.businessId,class:J({active:r.businessId===e.active.businessId}),onClick:p=>e.changeActive(r)},[C("span",null,H(r.businessName),1)],10,ue))),128)),e.loading?(_(),F("p",re,"加载中...")):I("",!0),e.nomore?(_(),F("p",se,"数据加载完成")):I("",!0)])),[[s,e.getCategoryData]])])}const de=w(ee,[["render",ie],["__scopeId","data-v-18277bde"]]);function ce(e){return B({url:"/business/food/admin/page",method:"post",data:e})}function pe(e){return B({url:"/business/food/admin",method:"post",data:e})}function me(e){return B({url:"/business/food/admin",method:"put",data:e})}function fe(e){return console.log(e),B({url:"/business/food/admin",method:"DELETE",data:e})}const q=[{value:1,label:"运动"},{value:2,label:"健身"},{value:3,label:"跑酷"},{value:4,label:"街舞"}],P=[{value:1,label:"今天"},{value:2,label:"明天"},{value:3,label:"后天"}],ge=E({components:{Layer:R,ImageUploader:Z},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,t){const l=v(null),u=v(null);let d=v({name:""});const c={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],number:[{required:!0,message:"请输入数字",trigger:"blur"}],choose:[{required:!0,message:"请选择",trigger:"blur"}],radio:[{required:!0,message:"请选择",trigger:"blur"}]};o();function o(){e.layer.row&&(d.value=JSON.parse(JSON.stringify(e.layer.row)))}return{form:d,rules:c,layerDom:u,ruleForm:l,selectData:q,radioData:P}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let t=this.form;this.layer.row?this.updateForm(t):this.addForm(t)}else return!1})},addForm(e){pe(e).then(t=>{this.$message({type:"success",message:"新增成功"}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()})},updateForm(e){me(e).then(t=>{this.$message({type:"success",message:"编辑成功"}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()})}}});function ve(e,t,l,u,d,c){const o=g("el-input"),s=g("el-form-item"),r=g("image-uploader"),p=g("el-form"),y=g("Layer",!0);return _(),N(y,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:f(()=>[a(p,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:f(()=>[a(s,{label:"食品名称",prop:"foodName"},{default:f(()=>[a(o,{modelValue:e.form.foodName,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.foodName=i),placeholder:"食品名称"},null,8,["modelValue"])]),_:1}),a(s,{label:"食品介绍",prop:"foodExplain"},{default:f(()=>[a(o,{modelValue:e.form.foodExplain,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.foodExplain=i),placeholder:"食品介绍"},null,8,["modelValue"])]),_:1}),a(s,{label:"食品价格",prop:"foodPrice"},{default:f(()=>[a(o,{modelValue:e.form.foodPrice,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.foodPrice=i),placeholder:"食品介绍"},null,8,["modelValue"])]),_:1}),a(s,{label:"原价",prop:"originPrice"},{default:f(()=>[a(o,{modelValue:e.form.originPrice,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.originPrice=i),placeholder:""},null,8,["modelValue"])]),_:1}),a(s,{label:"封面",prop:"cover"},{default:f(()=>[a(r,{"image-url":e.form.cover,"onUpdate:image-url":t[4]||(t[4]=i=>e.form.cover=i)},null,8,["image-url"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","onConfirm"])}const he=w(ge,[["render",ve]]);const _e=E({components:{Table:M,Layer:he},setup(){const e=T({input:""}),t=T({show:!1,title:"新增",showButton:!0}),l=T({index:1,size:20,total:0}),u=U("active"),d=v(!0),c=v([]),o=v([]),s=m=>{o.value=m},r=m=>{d.value=!0,m&&(l.index=1);let h={businessId:u.value.businessId,page:l.index,pageSize:l.size,...e};ce(h).then(n=>{let b=n.data.list;console.log(b),Array.isArray(b)&&b.forEach(D=>{const S=q.find(V=>V.value===D.choose);S?D.chooseName=S.label:D.chooseName=D.choose;const L=P.find(V=>V.value===D.radio);L?D.radioName=L.label:D.radio}),c.value=n.data.list,l.total=Number(n.data.total)}).catch(n=>{c.value=[],l.index=1,l.total=0}).finally(()=>{d.value=!1})},p=m=>{let h=m.map(n=>n.foodId);fe(h).then(n=>{X({type:"success",message:"删除成功"}),r(c.value.length===1)})},y=()=>{t.title="新增数据",t.show=!0,delete t.row},i=m=>{t.title="编辑数据",t.row=m,t.show=!0};return W(u,m=>{r(!0)}),{query:e,tableData:c,chooseData:o,loading:d,page:l,layer:t,handleSelectionChange:s,handleAdd:y,handleEdit:i,handleDel:p,getTableData:r}}}),ye={class:"layout-container"},be={class:"layout-container-form flex space-between"},De={class:"layout-container-form-handle"},Ce={class:"layout-container-form-search"},Fe={class:"layout-container-table"};function $e(e,t,l,u,d,c){const o=g("el-button"),s=g("el-popconfirm"),r=g("el-input"),p=g("el-table-column"),y=g("el-image"),i=g("Table"),m=g("Layer"),h=z("loading");return _(),F("div",ye,[C("div",be,[C("div",De,[a(o,{type:"primary",icon:"el-icon-circle-plus-outline",onClick:e.handleAdd},{default:f(()=>[$("新增")]),_:1},8,["onClick"]),a(s,{title:"批量删除",onConfirm:t[0]||(t[0]=n=>e.handleDel(e.chooseData))},{reference:f(()=>[a(o,{type:"danger",icon:"el-icon-delete",disabled:e.chooseData.length===0},{default:f(()=>[$("批量删除")]),_:1},8,["disabled"])]),_:1})]),C("div",Ce,[a(r,{modelValue:e.query.input,"onUpdate:modelValue":t[1]||(t[1]=n=>e.query.input=n),placeholder:"请输入关键词进行检索",onChange:t[2]||(t[2]=n=>e.getTableData(!0))},null,8,["modelValue"]),a(o,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:t[3]||(t[3]=n=>e.getTableData(!0))},{default:f(()=>[$("搜索")]),_:1})])]),C("div",Fe,[A((_(),N(i,{ref:"table",page:e.page,"onUpdate:page":t[4]||(t[4]=n=>e.page=n),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:f(()=>[a(p,{prop:"foodId",label:"食品编号","header-align":"center",align:"center"}),a(p,{prop:"foodName",label:"食品名称","header-align":"center",align:"center","min-width":"110"}),a(p,{prop:"foodExplain",label:"食品介绍","header-align":"center",align:"center","min-width":"110"}),a(p,{prop:"foodPrice",label:"食品介绍","header-align":"center",align:"center"}),a(p,{prop:"originPrice",label:"原价","header-align":"center",align:"center"}),a(p,{prop:"cover",label:"封面","header-align":"center",align:"center"},{default:f(n=>[a(y,{src:n.row.cover},null,8,["src"])]),_:1}),a(p,{label:"操作",align:"center",fixed:"right",width:"200"},{default:f(n=>[a(o,{onClick:b=>e.handleEdit(n.row)},{default:f(()=>[$("编辑")]),_:2},1032,["onClick"]),a(s,{title:"删除",onConfirm:b=>e.handleDel([n.row])},{reference:f(()=>[a(o,{type:"danger"},{default:f(()=>[$("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[h,e.loading]]),e.layer.show?(_(),N(m,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):I("",!0)])])}const Ee=w(_e,[["render",$e],["__scopeId","data-v-3c40e2e6"]]);const we=E({name:"categoryTable",components:{Category:de,myTable:Ee},setup(){let e=v({});Y("active",e)}}),Be={class:"full"},Ve={class:"left"},Te={class:"content"};function Ie(e,t,l,u,d,c){const o=g("category"),s=g("my-table");return _(),F("div",Be,[C("div",Ve,[a(o)]),C("div",Te,[a(s)])])}const ke=w(we,[["render",Ie],["__scopeId","data-v-1a1297b8"]]);export{ke as default};
